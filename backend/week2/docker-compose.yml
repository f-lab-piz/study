services:
  # PostgreSQL 데이터베이스
  db:
    image: postgres:15-alpine  # Alpine은 경량 Linux (용량 작음)
    container_name: week2-postgres
    environment:
      # 환경 변수로 DB 설정
      POSTGRES_USER: fastapi_user
      POSTGRES_PASSWORD: fastapi_pass
      POSTGRES_DB: fastapi_db
    ports:
      - "5432:5432"  # 호스트:컨테이너
    volumes:
      - postgres_data:/var/lib/postgresql/data  # 데이터 영구 저장
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U fastapi_user -d fastapi_db"]
      interval: 5s
      timeout: 5s
      retries: 5

# 볼륨 정의 (컨테이너 삭제해도 데이터 유지)
volumes:
  postgres_data:
